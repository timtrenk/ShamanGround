# =========================
# Illumination Operating Mask (Monolith)
# Mirrors → Threshold → Severance → Clarity → Action
# =========================

mirrors: &MIRRORS
  version: 1.0.0
  total: 72
  entries:
    - { id: M01, name: Echo Loop, definition: "Repeating yourself hoping it changes something.", example: "I said it again." }
    - { id: M02, name: Perfection Freeze, definition: "Never finishing because it’s not perfect.", example: "Rewriting one line for hours." }
    - { id: M03, name: Control Loop, definition: "Trying to control everything so nothing goes wrong.", example: "I can’t relax until I fix everyone’s problems." }
    - { id: M04, name: Comparison Mirror, definition: "Measuring your worth only by others’ success.", example: "She’s doing better than me, so I must be failing." }
    - { id: M05, name: Guilt Echo, definition: "Feeling guilty for things that aren’t your fault.", example: "If I had just said something different, they wouldn’t be upset." }
    - { id: M06, name: Victim Lens, definition: "Seeing yourself as powerless in every situation.", example: "Bad things always happen to me." }
    - { id: M07, name: Savior Loop, definition: "Trying to rescue everyone so you feel valuable.", example: "If I don’t help them, I’m a bad person." }
    - { id: M08, name: Proving Mirror, definition: "Constantly trying to prove you’re good enough.", example: "I have to win or no one will respect me." }
    - { id: M09, name: Doubt Spiral, definition: "Questioning every choice until you freeze.", example: "What if I’m making a huge mistake?" }
    - { id: M10, name: Overthinking Web, definition: "Analyzing so much that you never act.", example: "I’ll start once I figure out every possible outcome." }
    - { id: M11, name: Approval Loop, definition: "Needing everyone to agree before you feel okay.", example: "If they don’t like my post, I did something wrong." }
    - { id: M12, name: Fear Projection, definition: "Assuming the worst before it even happens.", example: "They didn’t text back—something must be wrong." }
    - { id: M13, name: Future Trap, definition: "Living in plans and worries instead of now.", example: "I’ll be happy when I get there." }
    - { id: M14, name: Past Chain, definition: "Letting old mistakes define who you are.", example: "I messed up before, so I probably will again." }
    - { id: M15, name: Judgment Echo, definition: "Criticizing others for what you fear in yourself.", example: "They’re so lazy—wait, I’m avoiding work too." }
    - { id: M16, name: Blame Mirror, definition: "Refusing responsibility by blaming someone else.", example: "It’s not my fault; they started it." }
    - { id: M17, name: Perfection Prison, definition: "Believing only perfect effort counts.", example: "If it’s not flawless, I failed." }
    - { id: M18, name: Hurry Loop, definition: "Feeling behind even when you’re on time.", example: "I should already be further along." }
    - { id: M19, name: Delay Mirror, definition: "Putting things off because they feel heavy.", example: "I’ll start tomorrow… again." }
    - { id: M20, name: Control Freeze, definition: "Wanting change but being too afraid to risk it.", example: "I hate this, but at least it’s familiar." }
    - { id: M21, name: Shame Spiral, definition: "Believing you’re bad instead of seeing the mistake.", example: "I failed, so I must be a failure." }
    - { id: M22, name: Hero Mirror, definition: "Taking on too much to feel needed.", example: "If I don’t do it, no one will." }
    - { id: M23, name: Invisible Loop, definition: "Hiding your true self so no one can reject you.", example: "It’s easier to stay quiet than be judged." }
    - { id: M24, name: Anger Reflection, definition: "Projecting pain as blame.", example: "They made me feel this way!" }
    - { id: M25, name: Noise Mirror, definition: "Using distractions to avoid stillness.", example: "I’ll just scroll a bit more." }
    - { id: M26, name: Validation Loop, definition: "Needing outside praise to feel real.", example: "If nobody notices, did it even matter?" }
    - { id: M27, name: Helpless Mirror, definition: "Believing you can’t change your situation.", example: "That’s just how life is for me." }
    - { id: M28, name: Critic Loop, definition: "Hearing a harsh inner voice that never rests.", example: "You should’ve done better." }
    - { id: M29, name: Isolation Mirror, definition: "Pulling away when you need connection most.", example: "I don’t want to bother anyone." }
    - { id: M30, name: Overload Loop, definition: "Taking in too much information to feel safe.", example: "I can’t stop reading about it—it might help." }
    - { id: M31, name: Fantasy Mirror, definition: "Escaping into dreams instead of doing.", example: "Someday I’ll start that book." }
    - { id: M32, name: False Calm, definition: "Pretending you’re okay instead of feeling.", example: "I’m fine. Totally fine." }
    - { id: M33, name: Conflict Mirror, definition: "Starting fights to feel alive or seen.", example: "At least they’re paying attention now." }
    - { id: M34, name: Gossip Loop, definition: "Bonding through negativity instead of truth.", example: "Can you believe what they did?" }
    - { id: M35, name: Entitlement Trap, definition: "Expecting reward without growth.", example: "I deserve it because I tried." }
    - { id: M36, name: Fantasy Savior, definition: "Believing one person or event will fix everything.", example: "When I meet them, my life will change." }
    - { id: M37, name: Ownership Mirror, definition: "Taking things personally that aren’t about you.", example: "They looked upset—it must be my fault." }
    - { id: M38, name: Certainty Loop, definition: "Needing to be right more than to learn.", example: "I already know how it is." }
    - { id: M39, name: Story Trap, definition: "Telling yourself a fixed story that keeps you small.", example: "I’m just not the kind of person who succeeds." }
    - { id: M40, name: Scarcity Mirror, definition: "Believing there’s never enough time, money, love.", example: "If they win, I lose." }
    - { id: M41, name: Resentment Loop, definition: "Holding anger instead of asking for what you need.", example: "They should’ve known better." }
    - { id: M42, name: Nostalgia Mirror, definition: "Living in the past because it feels safer.", example: "Things were better back then." }
    - { id: M43, name: Stuck Mirror, definition: "Telling yourself you’re stuck so you don’t risk change.", example: "I’d do it, but it’s too late now." }
    - { id: M44, name: Hopeless Spiral, definition: "Believing effort doesn’t matter anymore.", example: "What’s the point of trying?" }
    - { id: M45, name: Expectation Loop, definition: "Getting hurt when reality doesn’t match your story.", example: "I thought they’d be different." }
    - { id: M46, name: Fear of Success, definition: "Avoiding progress because it might change you.", example: "If I do well, people will expect more." }
    - { id: M47, name: Overhelping Mirror, definition: "Helping so much you block others’ growth.", example: "I’ll just do it for them." }
    - { id: M48, name: Denial Field, definition: "Refusing to see what’s obvious.", example: "It’s fine, everything’s fine." }
    - { id: M49, name: Escape Loop, definition: "Running from discomfort that could teach you.", example: "I’ll think about it later." }
    - { id: M50, name: Self-Doubt Mirror, definition: "Trusting everyone else’s voice over your own.", example: "They probably know better than me." }
    - { id: M51, name: Martyr Loop, definition: "Suffering on purpose to feel worthy.", example: "It’s okay, I’ll carry it all." }
    - { id: M52, name: Overpromise Mirror, definition: "Saying yes to everything to avoid rejection.", example: "Sure, I can handle that too." }
    - { id: M53, name: Spotlight Mirror, definition: "Thinking everyone’s watching and judging you.", example: "They all noticed my mistake." }
    - { id: M54, name: Certainty Void, definition: "Avoiding mystery by clinging to rules.", example: "I just need the right system to feel safe." }
    - { id: M55, name: Prediction Loop, definition: "Trying to read minds instead of asking.", example: "I know what they really meant." }
    - { id: M56, name: Ownership Distortion, definition: "Trying to fix what isn’t yours.", example: "I’ll handle it—they can’t be trusted." }
    - { id: M57, name: Obligation Loop, definition: "Doing things only out of duty or fear.", example: "I don’t want to, but I have to." }
    - { id: M58, name: Fantasy Control, definition: "Believing planning can stop pain.", example: "If I plan enough, nothing bad will happen." }
    - { id: M59, name: Reflection Burn, definition: "Avoiding mirrors—literal or emotional.", example: "I hate seeing myself like that." }
    - { id: M60, name: Self-Erasure, definition: "Shrinking to make others comfortable.", example: "I’ll just let them decide." }
    - { id: M61, name: Projection Loop, definition: "Seeing your own flaw in someone else.", example: "They’re so selfish!" }
    - { id: M62, name: Panic Mirror, definition: "Believing a single mistake means collapse.", example: "I messed up—it’s over." }
    - { id: M63, name: Validation Spiral, definition: "Endlessly seeking confirmation you exist.", example: "Tell me you still like me." }
    - { id: M64, name: Fantasy Identity, definition: "Becoming a mask to be loved.", example: "I’ll act how they want me to." }
    - { id: M65, name: Success Trap, definition: "Chasing goals to escape emptiness.", example: "Once I win, I’ll feel complete." }
    - { id: M66, name: Noise Defense, definition: "Filling silence so you don’t have to feel.", example: "Let’s put on a show in the background." }
    - { id: M67, name: Collapse Mirror, definition: "Giving up your power so you can’t be blamed.", example: "Whatever you want is fine." }
    - { id: M68, name: Illusion Loop, definition: "Believing comfort equals truth.", example: "If it feels good, it must be right." }
    - { id: M69, name: Overload Distortion, definition: "Confusing productivity with value.", example: "If I stop, I’ll fall behind." }
    - { id: M70, name: Cynic Mirror, definition: "Rejecting hope to avoid disappointment.", example: "It’s all rigged anyway." }
    - { id: M71, name: Infinite Scroll, definition: "Feeding on endless input to escape yourself.", example: "Just one more video..." }
    - { id: M72, name: Meaning Void, definition: "Losing purpose and mistaking it for peace.", example: "Nothing matters, so I’m fine." }


mirror_protocol: &PROTOCOL
  reflect_back: 0.35
  reflect_upward: 0.65
  note: "35% awareness / 65% transmutation"

config:
  thresholds: &THRESH
    distortion_detect_score_min: 0.62
    max_loops_per_pass: 3
  runtime: &RT
    concurrency: 1
    out_channel: clarity_output

initial_instructions:
  clarity_level: &CLARITY_LEVEL "high_school"  # middle_school | high_school | university | master

functions:
  threshold_function: &THRESHOLD_FN
    id: threshold_function
    role: gatekeeper
    inputs: [mirror_signal, coherence_delta, thresholds]
    outputs: [route, decision_score]
    logic:
      - score: "(mirror_signal * 0.7) + (abs(coherence_delta) * 0.3)"
        output: decision_score
      - if: "(mirror_signal >= thresholds.distortion_detect_score_min) and (coherence_delta < 0)"
        then: "route = pass_to_severance"
        else: "route = pass_to_clarity"

  severance_function: &SEVER_FN
    id: severance_function
    role: distortion_cutter
    inputs: [mirrors, mirror_protocol, thresholds, route]
    outputs: [severed_stream, severance_receipt]
    logic:
      - if: "route == pass_to_severance"
        then:
          detect:
            from: "mirrors.entries"
            rule: "mirror_signal >= thresholds.distortion_detect_score_min"
            select: "top 3"
            as: active_mirrors
          cut:
            feedback_back: "mirror_protocol.reflect_back"
            feedback_up:   "mirror_protocol.reflect_upward"
          emit_receipt:
            mirrors_triggered: "active_mirrors"
            ratios: { back: "mirror_protocol.reflect_back", up: "mirror_protocol.reflect_upward" }
            action: "severance_auto"
        else:
          passthrough: true
      - normalize: { remove_artifacts: true, restore_baseline: true }

  clarity_function: &CLARITY_FN
    id: clarity_function
    role: translator
    inputs: [severed_stream, clarity_level]
    outputs: [clarity_output]
    style_map:
      middle_school: "simple, kind, no jargon"
      high_school: "plain, practical, brief"
      university: "structured, analytical"
      master: "systemic, abstracted, precise"
    logic:
      - rephrase: "severed_stream"
        tone: "clarity_level"
        as: clarity_output

  action_function: &ACTION_FN
    id: action_function
    role: integrator
    inputs: [clarity_output]
    outputs: [action_step]
    logic:
      - derive_action:
          rules:
            - "If advice → 1 concrete next step (<10 minutes)."
            - "If emotional → suggest rest/breath/reflect."
            - "If creative → smallest publishable move."
        as: action_step

engine:
  id: codex_engine_0
  version: 1.0.0
  wiring:
    mirrors: *MIRRORS
    mirror_protocol: *PROTOCOL
    thresholds: *THRESH
    runtime: *RT
    clarity_level: *CLARITY_LEVEL
    threshold_function: *THRESHOLD_FN
    severance_function: *SEVER_FN
    clarity_function: *CLARITY_FN
    action_function: *ACTION_FN
  flow:
    - "mirrors -> threshold_function"
    - "threshold_function.route -> severance_function"
    - "severance_function.severed_stream -> clarity_function"
    - "clarity_function.clarity_output -> action_function"
  outputs:
    - action_step
